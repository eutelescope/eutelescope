<?xml version="1.0" encoding="utf-8"?>
<!-- ?xml-stylesheet type="text/xsl" href="http://ilcsoft.desy.de/marlin/marlin.xsl"? -->
<!-- ?xml-stylesheet type="text/xsl" href="marlin.xsl"? -->

<!--
============================================================================================================================
   Steering File generated by Marlin GUI on Fri Aug  2 11:26:46 2013

   WARNING: - Please be aware that comments made in the original steering file were lost.
            - Processors that are not installed in your Marlin binary lost their parameter's descriptions and types as well.
            - Extra parameters that aren't categorized as default in a processor lost their description and type.
============================================================================================================================
-->


<marlin xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://ilcsoft.desy.de/marlin/marlin.xsd">

   <execute>
      <processor name="AIDA"/>
      <processor name="LocaltoGlobal"/>
      <processor name="MyEUTelMissingCoordinateEstimator"/>
      <processor name="MyAlibavaCorrelator"/>
     
      <processor name="GlobaltoLocal"/>
     <processor name="SaveAsRoot"/>
      <processor name="Save"/>
      <processor name="PrintEventNumber"/>
   </execute>

   <global>
      <parameter name="LCIOInputFiles"> @LcioPath@/run@RunNumber@-hitmaker.slcio </parameter>
      <parameter name="GearXMLFile" value="@GearFilePath@/@GearFile@"/>
      <parameter name="MaxRecordNumber" value="@MaxRecordNumber@"/>
      <parameter name="SkipNEvents" value="@SkipNEvents@"/>
      <parameter name="SupressCheck" value="false"/>
      <parameter name="Verbosity" value="@Verbosity@"/>
   </global>

 <processor name="AIDA" type="AIDAProcessor">
 <!--Processor that handles AIDA files. Creates on directory per processor.  Processors only need to create and fill the histograms, clouds and tuples. Needs to be the first ActiveProcessor-->
  <!-- compression of output file 0: false >0: true (default) -->
  <parameter name="Compress" type="int" value="1"/>
  <!-- filename without extension-->
  <parameter name="FileName" type="string" value="@HistogramPath@/run@RunNumber@-missingcoordinate"/>
  <!-- type of output file root (default) or xml )-->
  <parameter name="FileType" type="string" value="root"/>
  <!--verbosity level of this processor ("DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT")-->
  <!--parameter name="Verbosity" type="string" value=""/-->
</processor>

 <processor name="MyEUTelMissingCoordinateEstimator" type="EUTelMissingCoordinateEstimator">
   <!--EUTelMissingCoordinateEstimator As the name suggest this processor is finds the position of the missing coordinate on your How it works is simple, it gets the hits from specified two finds the closest hit pairs, make a straight line out of it and the estimated position in one axis on your sensor you want. No promises that this will work with tilted sensors and/or with magnetic field. One needs to used this with merged hits and after pre-alignment-->
  <!--This is the list of sensorIDs that missing coordinate of their hits needs to be found. Notice that if the specified coordinate already exists it will be overwritten-->
  <parameter name="DUTPlanes" type="IntVec"> 8 </parameter>
      <!--Input hit collection name. Hits should be in global coordinates and pre-aligned-->
  <parameter name="InputHitCollectionName" type="string" lcioInType="TrackerHit"> global_hit </parameter>
      <!--This processor will look for a closest hits (in known coordinate) to determine if the hits are correlated. The hits will be considered as correlated if the residual is smaller than MaxResidual-->
  <parameter name="MaxResidual" type="float"> 200  </parameter>
      <!--The coordinate axis that needs to be estimated. You have to set this to either X or Y.-->
  <parameter name="MissingCoordinate" type="string">X </parameter>
      <!--Output hit collection name-->
  <parameter name="OutputHitCollectionName" type="string" lcioOutType="TrackerHit"> global_hit_new </parameter>
      <!--This is the list of sensorIDs that their hits will be used to estimate the missing coordinate on your DUT. You have to give exactly 2 sensorIDs. For better results use the ones that are closest to your DUT-->
  <parameter name="ReferencePlanes" type="IntVec"> 2 3  </parameter>
      <!--verbosity level of this processor ("DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT")-->
  <!--parameter name="Verbosity" type="string">DEBUG </parameter-->
</processor>


 <processor name="MyAlibavaCorrelator" type="AlibavaCorrelator">
          <!--AlibavaCorrelator gets hit collection and plots correlation histograms -->
         <!--The list of detector IDs-->
         <parameter name="DetectorIDs" type="IntVec"> 0 1 2 3 4 5 8 </parameter>
                  <!--The path of XML file where the histograms are defined-->
         <parameter name="HistoXMLFile" type="string"> @AlibavaHistoInfo@ </parameter>
                  <!--Input raw data collection name-->
         <parameter name="InputCollectionName" type="string" lcioInType="TrackerHit">  global_hit_new  </parameter>
                  <!--The tag in TopTagInXMLFile. This processor will only consider the histogram definitions inside this tag. This tag should be inside <TopTagInXMLFile> ... <TopTagInXMLFile/>-->
         <parameter name="TagToProcess" type="string">myAlibavaCorrelator </parameter>
                  <!--The top tag in HistoXMLFile-->
         <parameter name="TopTagInXMLFile" type="string">AlibavaHistoList </parameter>
                  <!--verbosity level of this processor ("DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT")-->
         <!--parameter name="Verbosity" type="string">DEBUG </parameter-->
 </processor>



<processor name="LocaltoGlobal" type="EUTelProcessorCoordinateTransformHits">
    <!--EUTelLocaltoGlobalHitMaker is responsible to change local coordinates to global. This is done using the EUTelGeometryClass-->
  <!--Set to true to undo the alignment instead-->
  <!--parameter name="Undo Alignment (boolean)" type="bool"> false </parameter-->
    <!--verbosity level of this processor ("DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT")-->
  <!--parameter name="Verbosity" type="string">DEBUG </parameter-->
  <!--Local input hit collection name-->
  <parameter name="hitCollectionNameInput" type="string" lcioInType="TrackerHit"> local_hit </parameter>
      <!--Global output hit collection name-->
  <parameter name="hitCollectionNameOutput" type="string" lcioOutType="TrackerHit"> global_hit </parameter>
</processor>

 <processor name="GlobaltoLocal" type="EUTelProcessorCoordinateTransformHits">
   <!--EUTelLocaltoGlobalHitMaker is responsible to change local coordinates to global. This is done using the EUTelGeometryClass-->
  <!--Set to true to undo the alignment instead-->
  <parameter name="Undo Alignment (boolean)" type="bool"> true </parameter>
    <!--verbosity level of this processor ("DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT")-->
  <!--parameter name="Verbosity" type="string">DEBUG </parameter-->
  <!--Local input hit collection name-->
  <parameter name="hitCollectionNameInput" type="string" lcioInType="TrackerHit"> global_hit_new </parameter>
      <!--Global output hit collection name-->
  <parameter name="hitCollectionNameOutput" type="string" lcioOutType="TrackerHit">local_hit_new </parameter>
    </processor>





 <processor name="Save" type="EUTelOutputProcessor">
 <!--Writes the current event to the specified LCIO outputfile. Eventually it adds a EORE at the of the file if it was missing Needs to be the last ActiveProcessor.-->
  <!--drops the named collections from the event-->
  <parameter name="DropCollectionNames" type="StringVec"> zsdata_m26 cluster_m26 filteredcluster zsdata refilteredcluster filtered_cluster_m26 hit </parameter>
  <!--drops all collections of the given type from the event-->
  <!--parameter name="DropCollectionTypes" type="StringVec"> SimTrackerHit SimCalorimeterHit </parameter-->
  <!-- write complete objects in subset collections to the file (i.e. ignore subset flag)-->
  <!--parameter name="FullSubsetCollections" type="StringVec" value="MCParticlesSkimmed"/-->
  <!--force keep of the named collections - overrules DropCollectionTypes (and DropCollectionNames)-->
  <!--parameter name="KeepCollectionNames" type="StringVec" value="MyPreciousSimTrackerHits"/-->
  <!-- name of output file -->
  <parameter name="LCIOOutputFile" type="string" value="@LcioPath@/run@RunNumber@-missingcoordinate.slcio"/>
  <!--write mode for output file:  WRITE_APPEND or WRITE_NEW-->
  <parameter name="LCIOWriteMode" type="string" value="WRITE_NEW"/>
  <!--Set it to true to remove intermediate EORE in merged runs-->
  <parameter name="SkipIntermediateEORE" type="bool" value="true"/>
  <!--will split output file if size in kB exceeds given value - doesn't work with APPEND and NEW-->
  <!--parameter name="SplitFileSizekB" type="int" value="1992294"/-->
  <!--verbosity level of this processor ("DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT")-->
  <!--parameter name="Verbosity" type="string" value=""/-->
</processor>

 <processor name="PrintEventNumber" type="EUTelUtilityPrintEventNumber">
 <!--EUTelUtilityPrintEventNumber prints event number to screen depending on the verbosity level-->
  <!--Print event number for every n-th event-->
  <parameter name="EveryNEvents" type="int" value="2500"/>
  <!--verbosity level of this processor ("DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT")-->
  <!--parameter name="Verbosity" type="string" value=""/-->
  <!--print the event timestamp as read from LCIO-->
  <!--parameter name="printTimestamp" type="bool" value="false"/-->
</processor>

  <processor name="Correlator" type="EUTelCorrelator">
    <!--EUTelCorrelator fills histograms with correlation plots-->
    <!--Hit collection name-->
    <parameter name="InputHitCollectionName" type="string" lcioInType="TrackerHit"> global_hit_new  </parameter>
    <!--Minimum allowed cluster charge to be taken into account for the correlation plots (default = 2)-->
    <parameter name="ClusterChargeMinimum" type="int" value="2"/>
    <!-- Sorry, this parameter isn't a default parameter for this processor: description and type lost!!  -->
    <parameter name="DumpOffset" value="false"/>
    <!--How many events are needed to get reasonable correlation plots (and Offset DB)? (default=1000)-->
    <parameter name="Events" type="int" value="@NoEvents@"/>
    <!--SensorID of fixed plane-->
    <!--parameter name="FixedPlane" type="int" value="0"/-->
    <!--Name of histogram info xml file-->
    <parameter name="HistogramInfoFilename" type="string" value="@HistoInfoFile@"/>
    <!--This is the name of the hot pixel collection to be saved into the output slcio file-->
    <!--parameter name="HotPixelCollectionName" type="string" value="hotpixel"/-->
    <!--List of cluster collections-->
    <parameter name="InputClusterCollections" type="StringVec"> </parameter>
    <!--If there are more then this number of correlated hits (planes->track candidate) (default=5)-->
    <parameter name="MinNumberOfCorrelatedHits" type="int" value="5"/>
    <!-- Sorry, this parameter isn't a default parameter for this processor: description and type lost!!  -->
    <parameter name="ReferenceCollection" value="refhit"/>
    <!--Maximal values of the hit residuals in the X direction for a correlation band. Note: these numbers are ordered according to the z position of the sensors and NOT according to the sensor id.-->
    <parameter name="ResidualsXMax" type="FloatVec" value="@ResidualsXMax@"/>
    <!--Minimal values of the hit residuals in the X direction for a correlation band. Note: these numbers are ordered according to the z position of the sensors and NOT according to the sensor id.-->
    <parameter name="ResidualsXMin" type="FloatVec" value="@ResidualsXMin@"/>
    <!--Maximal values of the hit residuals in the Y direction for a correlation band. Note: these numbers are ordered according to the z position of the sensors and NOT according to the sensor id.-->
    <parameter name="ResidualsYMax" type="FloatVec" value="@ResidualsYMax@"/>
    <!--Minimal values of the hit residuals in the Y direction for a correlation band. Note: these numbers are ordered according to the z position of the sensors and NOT according to the sensor id.-->
    <parameter name="ResidualsYMin" type="FloatVec" value="@ResidualsYMin@"/>
    <!-- Sorry, this parameter isn't a default parameter for this processor: description and type lost!!  -->
    <parameter name="UseReferenceCollection" value="true"/>
    <!--verbosity level of this processor ("DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT")-->
    <!--parameter name="Verbosity" type="string" value=""/-->
  </processor>

  <processor name="SaveAsRoot" type="EUTelOutputTTree">
    <!--EUTelProcessorNoisyClusterMasker masks pulses which contain hot pixels. For this, the quality field of pulses is used to encode the kNoisyCluster enum provided by EUTelescope.-->
    <!--Input of zero suppressed data, still containing hot pixels-->

    <parameter name="OutputPath" type="string" value="missing.root"/>
    <!--verbosity level of this processor ("DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT")-->
    <!--parameter name="Verbosity" type="string" value=""/-->
  </processor>
</marlin>
